{"name":"SQL Code Utilities","id":228,"content":"<pre>\n<code class=\"language-sql\">/**\n* TO FIND THE (SEST) DIFFERENCE BETWEEN TWO TABLES\n* Usage: SELECT find_delta('table_a', \n\t\t\t\t  'table_b', \n\t\t\t\t  'columns_a', \n\t\t\t\t  'columns_b')res FROM dual; -- In Oracle\n                  columns_b = '-do-' if the columns are same as in table_a\n**/\nCREATE OR REPLACE FUNCTION find_delta(table_a varchar2, table_b varchar2,  columnsA varchar2, columns_B varchar2)\nRETURN varchar2\nIS \n    columnsB varchar2(300);\n\tcountA NUMBER(20) := 0;\n    countB NUMBER(20) := 0;\n    countC NUMBER(20) := 0;\n    countD NUMBER(20) := 0;\n    res varchar2(1000);\nBEGIN \n    IF columns_B = '-do-' THEN\n        columnsB := columnsA;\n    ELSE\n        columnsB := columns_B;\n    END IF;    \n    \n\tres := '{ ';\n\tEXECUTE IMMEDIATE 'SELECT COUNT(1) cnt FROM \n        (SELECT ' || columnsA || ' from ' || table_a || \n            ' where (' || columnsA || ') not in (select '|| columnsB ||' from ' || table_b || '))' \n        INTO countA ;\n        \n    EXECUTE IMMEDIATE 'SELECT COUNT(1) cnt FROM \n        (SELECT ' || columnsB || ' from ' || table_b || \n            ' where (' || columnsB || ') not in (select '|| columnsA ||' from ' || table_a || '))' \n        INTO countB ;    \n        \n    EXECUTE IMMEDIATE 'SELECT COUNT(1) cnt FROM \n        (SELECT ' || columnsA || ' from ' || table_a || \n            ' where (' || columnsA || ') in (select '|| columnsB ||' from ' || table_b || '))' \n        INTO countC ;  \n        \n    EXECUTE IMMEDIATE 'SELECT COUNT(1) cnt FROM \n        (SELECT ' || columnsB || ' from ' || table_b || \n            ' where (' || columnsB || ') in (select '|| columnsA ||' from ' || table_a || '))' \n        INTO countD ;        \n\n\tres := res || '\"a-b\": ' || countA;\n    \n    res := res || ', \"b-a\": ' || countB;\n    \n    res := res || ', \"a.b\": ' || countC;\n    \n    res := res || ', \"b.a\": ' || countD;\n    \n    res := res || ' }';\n\treturn res;\nEND;</code></pre>\n\n<p>&nbsp;</p>\n","authorId":null,"subject":"hidden","tags":null,"img":null,"summary":"","lastUpdated":"2020-05-05T06:26:48.542+0000"}