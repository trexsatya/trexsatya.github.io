/*! rulez.js 2015-02-22 */
var Rulez=function(a){"use strict";function b(a){var c,d=a.cloneNode(!1);if(a instanceof Element){var e=window.getComputedStyle(a);if(e)for(c=0;c<e.length;c++){var f=e[c];d.style.setProperty(f,e.getPropertyValue(f),"")}}for(c=0;c<a.childNodes.length;c++)d.appendChild(b(a.childNodes[c]));return d}function c(){A||t.divisions.forEach(function(a){a.pixelGap>A&&(A=a.pixelGap)}),q=z-z%A+A*u,p=-A*u}function d(a,b){t.divisions.forEach(function(c){e(a,b,c)});var c=0;t.texts.forEach(function(d){var e=f(a,b,d);w[c]?w[c]=w[c].concat(e):w.push(e),c++})}function e(a,b,c){for(var d=a;b>d;d+=c.pixelGap){var e=g(d,c);v.appendChild(e),c.renderer&&c.renderer(e)}}function f(a,b,c){for(var d=[],e=a;b>e;e+=c.pixelGap){var f=j(e,c);v.appendChild(f),c.renderer&&c.renderer(f),d.push(f)}return d}function g(a,b){switch(b.type){case"line":return h(a,b);case"rect":return i(a,b);default:return i(a,b)}}function h(a,b){var c,d,e,f,g=document.createElementNS(r,"line");return l()?(c="y1",d="y2",e="x1",f="x2"):(c="x1",d="x2",e="y1",f="y2"),g.setAttribute("class",b.className),g.setAttribute(c,n(a)),g.setAttribute(d,n(a)),g.setAttribute(e,n("0")),g.setAttribute(f,n(b.lineLength)),g.setAttribute("stroke-width",n(b.strokeWidth)),g}function i(a,b){var c,d,e,f,g=document.createElementNS(r,"rect");return l()?(c="y",d="x",e="width",f="height"):(c="x",d="y",e="height",f="width"),g.setAttribute("class",b.className),g.setAttribute(c,n(a)),g.setAttribute(d,n("0")),g.setAttribute(e,n(b.lineLength)),g.setAttribute(f,n(b.strokeWidth)),g}function j(a,b){var c,d,e,f=document.createElementNS(r,"text");return f.setAttribute("class",b.className),l()?(c="y",d="x",e="rotate("+b.rotation+" "+b.offset*B+" "+a*B+")"):(c="x",d="y",e="rotate("+b.rotation+" "+a*B+" "+b.offset*B+")"),f.setAttribute(c,n(a)),f.setAttribute(d,n(b.offset)),f.setAttribute("transform",e),f.textContent=b.showUnits?n(a):a,f}function k(){return document.createElementNS(r,"g")}function l(){return"vertical"===t.layout}function m(a,b,c){if(!b)return a;for(var d in b)if(b.hasOwnProperty(d))switch(d){case"divisionDefaults":case"textDefaults":m(a[d],b[d]);break;default:c&&a[d]||(a[d]=b[d])}return a.divisions&&a.divisions.forEach(function(b){m(b,a.divisionDefaults,b),b.className||(b.className="line"===b.type?"rulez-line":"rulez-rect")}),a.texts&&a.texts.forEach(function(b){m(b,a.textDefaults,b)}),a}function n(a){return a+t.units}function o(){if(""===t.units||"px"===t.units)return 1;var a=document.createElement("div");a.style.position="absolute",a.style.top="-100000px",a.style.left="-100000px",a.style.zIndex=-1e5,a.style.width=a.style.height=n(1),document.body.appendChild(a);var b=window.getComputedStyle(a).width.replace("px","");return document.body.removeChild(a),b}var p,q,r="http://www.w3.org/2000/svg",s={width:null,height:null,element:null,layout:"horizontal",units:"",divisionDefaults:{strokeWidth:1,type:"rect",className:"rulez-rect",renderer:null},textDefaults:{rotation:0,offset:25,className:"rulez-text",showUnits:!1,renderer:null},divisions:[{pixelGap:5,lineLength:5},{pixelGap:25,lineLength:10},{pixelGap:50,lineLength:15},{pixelGap:100,lineLength:20}],texts:[{pixelGap:100}]},t=m(JSON.parse(JSON.stringify(s)),a),u=2,v=k(),w=[],x=0,y=1;t.width=t.width?t.width:t.element.getBoundingClientRect().width,t.height=t.height?t.height:t.element.getBoundingClientRect().height,t.element.appendChild(v);var z=l()?t.height:t.width,A=0,B=o();this.render=function(){c(),d(p,q)},this.scrollTo=function(a,b){x=a,b&&(x*=B),l()?v.setAttribute("transform","translate(0,"+-x%(A*B)+")"):v.setAttribute("transform","translate("+-x%(A*B)+",0)");for(var c=x/B,d=0;d<t.texts.length;d++)for(var e=t.texts[d],f=w[d],g=A/e.pixelGap,h=c%A,i=c-h,j=0;j<f.length;j++){var k=f[j],m=Math.floor((i+(j-u*g)*e.pixelGap)*y);e.showUnits&&(m=n(m)),k.textContent=m}},this.setScale=function(a){y=a,this.scrollTo(x)},this.resize=function(){var a=z,b=l()?t.element.clientHeight:t.element.clientWidth;if(a!==b)if(a>b);else{z=b;var e=q;c(),d(e,q),this.scrollTo(x)}},this.saveAsImage=function(a){var c=b(t.element);c.setAttribute("width",t.width),c.setAttribute("height",t.height);var d=document.createElement("canvas");d.setAttribute("width",t.width),d.setAttribute("height",t.height);var e=d.getContext("2d"),f=window.URL||window.webkitURL,g=new Image;g.style.position="absolute",g.style.top="-100000px",g.style.left="-100000px",g.style.zIndex=-1e5,g.setAttribute("width",t.width),g.setAttribute("height",t.height);var h=new Blob([c.outerHTML],{type:"image/svg+xml;charset=utf-8"}),i=f.createObjectURL(h);g.onload=function(){setTimeout(function(){e.drawImage(g,0,0),f.revokeObjectURL(i),a(d.toDataURL())},1e3)},document.body.appendChild(g),g.src=i},this.getUnitConversionRate=function(){return o()}};